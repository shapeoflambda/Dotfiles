#+TITLE: My Doom Configuration

* Personal Information
#+BEGIN_SRC emacs-lisp
(setq user-full-name "Harish Chandran")
#+END_SRC

* Appearance
** Theme
#+BEGIN_SRC emacs-lisp
(setq doom-theme 'doom-tomorrow-night)
#+END_SRC

** Display Font
#+BEGIN_SRC emacs-lisp
(setq doom-font (font-spec :family "Fira Code" :size 18))
#+END_SRC

** Pretty bullets for Org-mode
#+BEGIN_SRC emacs-lisp
(add-hook 'org-mode-hook (lambda () (org-superstar-mode 1)))
#+END_SRC
* Preferences
** Inhibit startup screen
#+BEGIN_SRC emacs-lisp
(setq inhibit-startup-screen t)
#+END_SRC

** Disable line numbers
This determines the style of line numbers in effect. If set to `nil', line
numbers are disabled. For relative line numbers, set this to `relative'.
#+BEGIN_SRC emacs-lisp
(setq display-line-numbers-type nil)
#+END_SRC

** =recentf= Settings

#+BEGIN_SRC emacs-lisp
(setq recentf-max-saved-items 100
      recentf-exclude '("/tmp/"
                        "/ssh:"
                        "/sudo:"
                        "recentf$"
                        "company-statistics-cache\\.el$"
                        ;; ctags
                        "/TAGS$"
                        ;; global
                        "/GTAGS$"
                        "/GRAGS$"
                        "/GPATH$"
                        ;; binary
                        "\\.mkv$"
                        "\\.mp[34]$"
                        "\\.avi$"
                        "\\.pdf$"
                        "\\.docx?$"
                        "\\.xlsx?$"
                        ;; sub-titles
                        "\\.sub$"
                        "\\.srt$"
                        "\\.ass$"
                        ;; autosave files
                        "workspaces/autosave$"
                        ))
#+END_SRC

* Org-mode
** Agenda files
#+BEGIN_SRC emacs-lisp
(setq org-agenda-files (list
    "~/org/tasks/tasks.org"))
#+END_SRC

** Custom TODO states
Define the TODO states that I use
#+BEGIN_SRC emacs-lisp
(setq org-todo-keywords '((sequence "TODO(t)" "IN-PROGRESS(i)" "BLOCKED(b)" "|" "DONE(d)" "KILL(k)")
 (sequence "[ ](T)" "[-](S)" "[?](W)" "|" "[X](D)")))
#+END_SRC

** Change =TODO= entry to automatically change to DONE when all children are done
#+BEGIN_SRC emacs-lisp
(defun org-summary-todo (n-done n-not-done)
  "Switch entry to DONE when all subentries are done, to TODO otherwise."
  (let (org-log-done org-log-states)   ; turn off logging
    (org-todo (if (= n-not-done 0) "DONE" "TODO"))))

(add-hook 'org-after-todo-statistics-hook 'org-summary-todo)
#+END_SRC

** Log the time when a TODO item is marked as =DONE=
#+BEGIN_SRC emacs-lisp
(setq org-log-done 'time)
#+END_SRC

** Don't evaluate src blocks during export
#+BEGIN_SRC emacs-lisp
(setq org-export-babel-evaluate nil)
#+END_SRC

** Fold outlines when opening an =org= file
#+BEGIN_SRC emacs-lisp
(setq org-startup-folded t)
#+END_SRC

** Enable spell check by default
   #+begin_src emacs-lisp
   (add-hook 'org-mode-hook 'turn-on-flyspell)
   #+end_src

   Don't check in source code and other blocks
   #+begin_src emacs-lisp
   (defadvice org-mode-flyspell-verify (after org-mode-flyspell-verify-hack activate)
  (let* ((rlt ad-return-value)
         (begin-regexp "^[ \t]*#\\+begin_\\(src\\|html\\|latex\\|example\\|quote\\)")
         (end-regexp "^[ \t]*#\\+end_\\(src\\|html\\|latex\\|example\\|quote\\)")
         (case-fold-search t)
         b e)
    (when ad-return-value
      (save-excursion
        (setq b (re-search-backward begin-regexp nil t))
        (if b (setq e (re-search-forward end-regexp nil t))))
      (if (and b e (< (point) e)) (setq rlt nil)))
    (setq ad-return-value rlt)))
   #+end_src

** Export to a different directory
  #+begin_src emacs-lisp
  (defadvice org-export-output-file-name (before org-add-export-dir activate)
  "Modifies org-export to place exported files in a different directory"
  (when (not pub-dir)
      (setq pub-dir "exported-org-files")
      (when (not (file-directory-p pub-dir))
       (make-directory pub-dir))))
   #+end_src

* Mappings
** General
*** File finding
#+BEGIN_SRC emacs-lisp
(define-key evil-normal-state-map ",f" 'counsel-fzf)
(define-key evil-normal-state-map ",rf" 'counsel-recentf)
#+END_SRC

*** Describe things
#+BEGIN_SRC emacs-lisp
(define-key evil-normal-state-map ",df" 'describe-functions)
(define-key evil-normal-state-map ",dk" 'describe-key)
(define-key evil-normal-state-map ",dv" 'describe-variable)
#+END_SRC

** Git
#+BEGIN_SRC emacs-lisp
(define-key evil-normal-state-map "]g" 'git-gutter:next-hunk)
(define-key evil-normal-state-map "[g" 'git-gutter:previous-hunk)
(define-key evil-normal-state-map ",gu" 'git-gutter:revert-hunk)
(define-key evil-normal-state-map ",gs" 'git-gutter:stage-hunk)
(define-key evil-normal-state-map ",gg" 'magit-status)
#+END_SRC

** Org-mode
#+BEGIN_SRC emacs-lisp
(define-key evil-normal-state-map ",oa" 'org-agenda)
(define-key evil-normal-state-map ",os" 'org-schedule)
(define-key evil-normal-state-map ",od" 'org-deadline)
(define-key evil-normal-state-map ",ot" 'org-todo)
(define-key evil-normal-state-map "  " 'org-todo)
(define-key evil-normal-state-map ",rr" 'org-babel-remove-result)
#+END_SRC

* Snippets

#+BEGIN_SRC emacs-lisp
(yas-global-mode 1)
#+END_SRC

* Ivy
Enable fuzzy matching

#+BEGIN_SRC emacs-lisp
(setq ivy-re-builders-alist '((counsel-rg . ivy--regex-plus)
 (swiper . ivy--regex-plus)
 (swiper-isearch . ivy--regex-plus)
 (t . ivy--regex-fuzzy)))
#+END_SRC

* Evil
** Get back default VIM behavior
#+BEGIN_SRC emacs-lisp
(evil-put-command-property 'evil-yank-line :motion 'evil-line)
(setq evil-want-change-word-to-end nil)
#+END_SRC

** Custom Text Objects
Select the entire document using 'd' and the current line 'l'. For example, =did= deletes the entire
document. Credits:[[github:https://github.com/syohex/evil-textobj-entire/blob/master/evil-textobj-entire.el][evil-textobj-entire.el]] & [[github:https://github.com/emacsorphanage/evil-textobj-line/blob/master/evil-textobj-line.el][evil-textobj-line.el]]
#+BEGIN_SRC emacs-lisp
(defcustom evil-custom-textobj-entire-key "d"
  "Key for evil-inner-entire"
  :type 'string
  :group 'evil-custom-textobj)

(defcustom evil-custom-textobj-in-line-key "l"
  "Keys for evil-inner-line"
  :type 'string
  :group 'evil-custom-textobj)

(defcustom evil-custom-textobj-around-line-key "l"
  "Keys for evil-around-line"
  :type 'string
  :group 'evil-custom-textobj)

(defun evil-line-range (count beg end type &optional inclusive)
  (if inclusive
      (evil-range (line-beginning-position) (line-end-position))
    (let ((start (save-excursion
                   (back-to-indentation)
                   (point)))
          (end (save-excursion
                 (goto-char (line-end-position))
                 (skip-syntax-backward " " (line-beginning-position))
                 (point))))
      (evil-range start end))))

(evil-define-text-object evil-custom-entire-buffer (count &optional beg end type)
  "Select entire buffer"
  (evil-range (point-min) (point-max)))

(evil-define-text-object evil-custom-around-line (count &optional beg end type)
  "Select range between a character by which the command is followed."
  (evil-line-range count beg end type t))
(evil-define-text-object evil-custom-inner-line (count &optional beg end type)
  "Select inner range between a character by which the command is followed."
  (evil-line-range count beg end type))

(define-key evil-outer-text-objects-map evil-custom-textobj-entire-key 'evil-custom-entire-buffer)
(define-key evil-inner-text-objects-map evil-custom-textobj-entire-key 'evil-custom-entire-buffer)
(define-key evil-outer-text-objects-map evil-custom-textobj-in-line-key 'evil-custom-around-line)
(define-key evil-inner-text-objects-map evil-custom-textobj-around-line-key 'evil-custom-inner-line)
#+END_SRC

** Split settings
Open splits to the right or in the bottom
#+BEGIN_SRC emacs-lisp
(setq evil-split-window-bottom t)
(setq evil-vsplit-window-right t)
#+END_SRC
* Git gutter
#+BEGIN_SRC emacs-lisp
(custom-set-variables
 '(git-gutter:update-interval 2))
#+END_SRC
